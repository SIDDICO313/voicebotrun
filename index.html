<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCO_VOICE_BOT</title>
<style>
  body { font-family: Arial; text-align: center; padding: 30px; margin: 0; background: linear-gradient(135deg,#6a11cb,#2575fc); color:white; min-height:100vh; display:flex; flex-direction:column; justify-content:center;}
  h1{font-size:2.5rem;margin-bottom:10px;}
  p{margin-bottom:20px;font-size:1.2rem;}
  #log{margin-top:20px;text-align:left;max-width:700px;margin-inline:auto;background:rgba(255,255,255,0.1);padding:20px;border-radius:12px;color:#f1f1f1;font-size:1rem;max-height:300px;overflow-y:auto;}
  b{color:#ffd700;} i{color:#dcdcdc;}
</style>
</head>
<body>
<h1>MCO_VOICE_BOT</h1>
<p>Click anywhere to start talking. It will listen continuously.</p>
<div id="log"></div>

<script>
const logBox = document.getElementById("log");
function log(text){logBox.innerHTML += `<p>${text}</p>`; logBox.scrollTop = logBox.scrollHeight;}

let recognition;
function initRecognition(){
  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";

  recognition.onresult = async (event)=>{
    const transcript = event.results[0][0].transcript;
    log("<b>You:</b> "+transcript);
    recognition.abort(); // stop temporarily while speaking
    await handleQuery(transcript);
    recognition.start(); // restart listening after speaking
  };

  recognition.onend = ()=>{
    if(!speechSynthesis.speaking){
      recognition.start();
    }
  };
}

// Start listening
function startListening(){
  if(!recognition) initRecognition();
  recognition.start();
  log("<i>Listening...</i>");
}

// Main handler
async function handleQuery(query){
  let result = null;

  log("<i>Searching...</i>");
  result = await fetchWikipedia(query);

  if(!result){
    log("<i>Searching...</i>");
    result = await fetchDuckDuckGo(query);
  }

  if(!result){
    log("<i>Searching...</i>");
    result = await fetchArxiv(query);
  }

  if(!result){
    log("<i>Searching...</i>");
    result = await fetchStackExchange(query);
  }

  if(!result){
    const fallback = "Sorry, I couldn't find that information.";
    log("<b>MCO_VOICE_BOT:</b> "+fallback);
    await speak(fallback);
  } else {
    log("<b>MCO_VOICE_BOT:</b> "+result);
    await speak(result);
  }
}

// Wikipedia
async function fetchWikipedia(query){
  try{
    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
    if(!response.ok) return null;
    const data = await response.json();
    return data.extract||null;
  } catch(e){return null;}
}

// DuckDuckGo
async function fetchDuckDuckGo(query){
  try{
    const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json`);
    const data = await response.json();
    return data.Abstract || null;
  } catch(e){return null;}
}

// arXiv
async function fetchArxiv(query){
  try{
    const response = await fetch(`https://export.arxiv.org/api/query?search_query=all:${encodeURIComponent(query)}&start=0&max_results=1`);
    const text = await response.text();
    const match = text.match(/<summary>(.*?)<\/summary>/s);
    return match ? match[1].replace(/\n/g,' ') : null;
  } catch(e){ return null; }
}

// StackExchange
async function fetchStackExchange(query){
  try{
    const response = await fetch(`https://api.stackexchange.com/2.3/search?order=desc&sort=relevance&intitle=${encodeURIComponent(query)}&site=stackoverflow`);
    const data = await response.json();
    return data.items && data.items.length ? data.items[0].title + " - " + data.items[0].link : null;
  } catch(e){ return null; }
}

// Speak
function speak(text){
  return new Promise(resolve=>{
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang="en-US";
    utter.onend = resolve;
    speechSynthesis.speak(utter);
  });
}

// Start on click
document.body.addEventListener("click", ()=>{
  const intro="MCO VOICE BOT, created by Siddiqul Akbar.";
  log("<b>MCO_VOICE_BOT:</b> "+intro);
  speak(intro).then(()=>startListening());
}, {once:true});
</script>
</body>
</html>
