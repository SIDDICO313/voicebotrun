<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCO_VOICE_BOT</title>
<style>
  body { font-family: Arial; text-align: center; padding: 30px; margin: 0; background: linear-gradient(135deg,#6a11cb,#2575fc); color:white; min-height:100vh; display:flex; flex-direction:column; justify-content:center;}
  h1{font-size:2.5rem;margin-bottom:10px;}
  p{margin-bottom:20px;font-size:1.2rem;}
  #log{margin-top:20px;text-align:left;max-width:700px;margin-inline:auto;background:rgba(255,255,255,0.1);padding:20px;border-radius:12px;color:#f1f1f1;font-size:1rem;max-height:300px;overflow-y:auto;}
  b{color:#ffd700;} i{color:#dcdcdc;}
</style>
</head>
<body>
<h1>MCO_VOICE_BOT</h1>
<p>Click anywhere to start talking. It will listen continuously.</p>
<div id="log"></div>

<script>
const logBox = document.getElementById("log");

function log(text){logBox.innerHTML += `<p>${text}</p>`; logBox.scrollTop = logBox.scrollHeight;}

let recognition;
function initRecognition(){
  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "en-US";

  recognition.onresult = async (event)=>{
    const transcript = event.results[0][0].transcript;
    log("<b>You:</b> "+transcript);
    recognition.abort(); // stop temporarily while speaking
    await handleQuery(transcript);
    recognition.start(); // restart listening after speaking
  };

  recognition.onend = ()=>{
    // restart recognition automatically if it stopped
    if(!speechSynthesis.speaking){
      recognition.start();
    }
  };
}

// Start listening
function startListening(){
  if(!recognition) initRecognition();
  recognition.start();
  log("<i>Listening...</i>");
}

// Handle query with Wikipedia
async function handleQuery(query){
  log("<i>Searching Wikipedia...</i>");
  const wikiSummary = await fetchWikipedia(query);
  if(wikiSummary){
    log("<b>MCO_VOICE_BOT:</b> "+wikiSummary);
    await speak(wikiSummary);
  } else{
    const fallback="Sorry, I couldn't find that on Wikipedia.";
    log("<b>MCO_VOICE_BOT:</b> "+fallback);
    await speak(fallback);
  }
}

// Wikipedia fetch
async function fetchWikipedia(query){
  try{
    const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
    if(!response.ok) return null;
    const data = await response.json();
    return data.extract||null;
  } catch(e){return null;}
}

// Speak function with Promise to wait
function speak(text){
  return new Promise(resolve=>{
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang="en-US";
    utter.onend = resolve;
    speechSynthesis.speak(utter);
  });
}

// User interaction required to start speech
document.body.addEventListener("click", ()=>{
  const intro="MCO VOICE BOT, created by Siddiqul Akbar the creator of MASTER CO TUTORIALS.";
  log("<b>MCO_VOICE_BOT:</b> "+intro);
  speak(intro).then(()=>startListening());
}, {once:true});
</script>
</body>
</html>